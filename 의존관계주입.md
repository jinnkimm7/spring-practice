# 의존관계 주입

스프링에서 의존관계 주입 방법은 다음 4가지가 있다. 
1. 생성자 주입 

2. Setter 주입(수정자 주입)

3. 필드 주입

4. 일반 메서드 주입

> 4가지 방법 중에 의존관계 주입을 할 때, 항상 `생성자 주입`을 사용하자!  
> 가끔 필수값이 아닐 때, 옵션이 필요하면 수정자 주입을 사용하자.

--- 

### 생성자 주입 ?
- 말 그대로 생성자를 통해 의존관계를 주입한다.

```java
@Component
public class OrderServiceImpl implements OrderService {
  private final MemberRepository memberRepository;
  private final DiscountPolicy discountPolicy;

  @Autowired
  public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
    this.memberRepository = memberRepository;
    this.discountPolicy = discountPolicy;
  }
}
```
- 특징
  - 생성자 호출 시점에 딱 한 번만 호출된다. -> 호출 시점에 의존관계를 주입하고, 이후에 의존관계 주입을 할 수 없다. (`불변`)
  - 생성자를 통해 필드에 무조건 값이 존재해야한다. (final 키워드, `필수`)
  - `불변, 필수` 의존관계에 사용된다.
  - 만약에 생성자가 한 개만 있다면, @Autowired를 생략해도 의존관계가 자동으로 주입된다.


### 왜 생성자 주입을 사용해야 하는가?

`* 불변 *`  
- 의존관계 주입은, 마치 공연을 하기 전에 배역이 정해지듯이, 애플리케이션이 종료 될 때까지 의존관계가 바뀌지 않는다.
- 오히려 의존관계는 애플리케이션 종료 시까지 바뀌어서는 안된다.
- 생성자 주입은 객체를 생성할 때(생성자 호출 시점) 한 번 호출된 이후로, 호출되지 않는다. 따라서 `불변`한다.

`* final 키워드 *`
- 생성자 주입을 사용하면 필드에 `final` 키워드를 사용할 수 있다.
- `final` 키워드를 사용하면, 혹시나 생성자에 값이 존재하지 않는다면 컴파일 시점에 오류를 발생시킨다.

---

## 옵션 처리
> - @Autowired의 required 디폴트값이 true이기 때문에 오류가 발생한다.(@Autowired(require=true)) 
> - 하지만 `주입할 스프링 빈이 없어도 동작`해야하는 경우가 있는데, 어떻게해야할까?  
  
1. @Autowired(required = false) : 주입할 대상이 없으면 메서드자체가 호출이 안됨.
2. org.springframework.lang.@Nullable : 주입할 대상이 없으면null값을 반환.
3. Optional <> : 주입할 대상이 없으면 Optional.empty를 반환.